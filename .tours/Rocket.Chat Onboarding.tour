{
  "$schema": "https://aka.ms/codetour-schema",
  "title": "11 - Rocket.Chat Onboarding",
  "steps": [
    {
      "title": "Codetours extension tutorial",
      "description": "## Codetours extension tutorial\n\n- To use Codetours extension in the best way possible use please turn on this setting [link](command:workbench.action.openSettings?%22Comments%3A%20Max%20Height%22)\n\n- To run any command, click on the command and it will run in a **codetour** terminal\n- Set default nodejs version to 14 while using nvm for commands to work correclty\n\n>> nvm alias default 14\n\n- To start codetour use **ctrl+shift+p** and type **start tour**"
    },
    {
      "title": "Interactive Tutorial to setup the project",
      "description": "The officials documentation to install Rocket.Chat can be found be [link](https://developer.rocket.chat/v1/docs/server-environment-setup). This tour is an interactive guide only for **WINDOWS** user using **WSL**.[docs](https://developer.rocket.chat/v1/docs/windows-10). If you are stuck follow this\n\nFirst of check if you are inside the WSL shell\n>> lsb_release -a\n\nshould give an output like this\n```bash\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 22.04.4 LTS\nRelease:        22.04\nCodename:       jammy\n```\nNow follow these commands\n>> sudo apt-get update && sudo apt-get dist-upgrade -y\n\n>> sudo apt-get install build-essential python3 make g++\n\nInstall node 14 using nvm by following [docs](https://github.com/nvm-sh/nvm)\n\nCheck nvm and node version\n>> command -v nvm && node -v\n\nshould give an output like this\n\n```bash\nnvm\nv14.xx.x\n```\nSet node 14 as default (very imporant for **tours scripts** to work correctly)\n>> nvm alias default 14\n\n>> curl https://install.meteor.com/ | sh\n\n>> npm install --global yarn\n\nAssuming that your are already at the root level of the directory\n\n>> yarn\n\n>> yarn dsv\n\nIf everything went well, you should see a screen like this\n\n```bash\n +-----------------------------------------------+\n |                 SERVER RUNNING                |\n +-----------------------------------------------+\n |                                               |\n |  Rocket.Chat Version: 6.7.0-develop           |\n |       NodeJS Version: 14.21.4 - x64           |\n |      MongoDB Version: 7.0.5                   |\n |       MongoDB Engine: wiredTiger              |\n |             Platform: linux                   |\n |         Process Port: 25523                   |\n |             Site URL: http://localhost:3000/  |\n |     ReplicaSet OpLog: Enabled                 |\n |          Commit Hash: 1c2f31387d              |\n |        Commit Branch: codetours_tours         |\n |                                               |\n+-----------------------------------------------+\n```\n\nNote the the values will be different but you must be able to access the Rocket.Chat server in **Site URL**"
    },
    {
      "title": "Debugging Tips/Tricks",
      "description": "## Here we will learn various debugging tips and tricks making your life easy as a Rocket.Chat contributor\n\n#### Lets take an example of debugging an *issue when a message is send*\n\n\n- It is a recommendation to use **(going into apps/meteor and using \"yarn run debug\" )**\n>> cd apps/meteor &&  yarn run debug && cd ../..\n\nto run the project instead of **yarn dsv**. We will know the reason later in the guide.\n\n- We will learn how to use chrome dev tools to our advantage\n\n- Install [react-dev-tools](https://chromewebstore.google.com/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?pli=1) in your chrome browser\n\n- Since you are new to the codebase and dont know where the corresponding frontend and backend files are, lets start from first principals and try to find the component responsible for rendering the message composer.(we are trying to find all the files responsible for sending a message)"
    },
    {
      "title": "Client Side Debugging 1",
      "description": "- Open react-dev tools and click here\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721317438/Codetours/Onboarding/a63069dc-25a4-483b-ad62-d3841c6344d3.png)\n\n- Now click here in the browser where rocket.chat is running\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721317531/Codetours/Onboarding/de746d98-41c4-42b6-85db-7514ef11fe10.png)\n\nYou might ask, we wanted to debug a message bug why are we doing this. See we need to find the functions responsible for that bug, and inside a codebase of hundreds of lines you can easily be lost, so we go step by step.\n\n- Now you can see the react components rendering our message-composer, the starting point where sending messages happens.\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721317705/Codetours/Onboarding/5e17c7b0-b798-46c9-abd7-9f9008ab4067.png)\n\nGo to [RoomBody.tsx](./apps/meteor/client/views/room/body/RoomBody.tsx).Now you have a file from where you should keep digging in.\n\n- Now to dig in further, either commenting out components or repeat the above steps"
    },
    {
      "title": "Client Side Debugging 2",
      "description": "- If you followed the above steps correctly, you should reach [here](./apps/meteor/client/views/room/composer/messageBox/MessageBox.tsx) and this will the first function responsible for sending the message \n\n```js\nconst handleSendMessage = useMutableCallback(() => {\n\t\tconst text = chat.composer?.text ?? '';\n\t\tconsole.log(text);\n\t\t....\n```\n\nNote console.log in client side code will be visible in the browser and that of server side code will be visible in the terminal where rocket.chat is running.\n\nThe problem with console.log is that the server need to reload and it takes time. So we will be using breakpoints in chrome browser, instead of console.log.\n\n- Right Click in the browser -> Inspect -> Sources -> ctrl+p and name the file which where you want to set a break point to the value which you want to see.\n\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721393926/Codetours/Onboarding/672ed2d1-26a2-4b1f-8a4a-6ff8555283a8.png)\n\n\n- Now type something in the chat box and you will see the code execution has stopped at the line where you had set the break point.\n\nUse these buttons to navigate further code executions or you can use breakpoints also\n\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721394094/Codetours/Onboarding/92f41be0-b39f-4a45-a40f-303abbfdd5f2.png)\n\n- When you click on **Step over next function call**, you can see the value which is assigned to the variable **text** is visible "
    },
    {
      "title": "Server Side Debugging 1",
      "description": "#### Note: Its is by default nature, that client side javascript can be accessed from browser but server side javascript cant be accessed. \n\n- So if we need to debug server side javascript we cant use the above method, or can we! We can if we somehow access the server side code in the browser. This can be done using the script which I have told you before. Go cd into apps/meteors and run the command\n\n>> yarn debug\n\nThis will push server side nodejs code into the browser. Allowing you to set breakpoints and debug it.\n\n- To see the server side code in the browser\nRight Click-> Inspect -> and click in the nodejs icon\n\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721395071/Codetours/Onboarding/0992f457-b611-4fbe-8e19-a5be2ba495a1.png)"
    },
    {
      "title": "Server Side Debugging 2",
      "description": "- Lets take an example from our previous issue of *sending a message*  and set up a break point\n\n- If follow the above steps well, you can easily find out that inside this [this file](./apps/meteor/app/lib/server/methods/sendMessage.ts), this is the first server side function to send a message\n\n```javascript\nMeteor.methods<ServerMethods>({\n\tasync sendMessage(message, previewUrls) {\n\t\tcheck(message, Object);\n```\n\n- Now find the same and setup a break point, follow the same previos steps to see, how the code flow works.\n\n![](https://res.cloudinary.com/dty2rgx6f/image/upload/v1721396309/Codetours/Onboarding/3c75e212-5320-4385-bf2e-839dae4e331e.png)"
    },
    {
      "title": "VsCode Shortcuts",
      "description": "#### These are some curated lists of vscode shortcuts which you should frequently use for a codebase as big as rocket.chat\n\nNote: This is not an exhaustive guide but just to say you must use these to make your life easy",
      "selection": {
        "start": {
          "line": 3,
          "character": 48
        },
        "end": {
          "line": 3,
          "character": 51
        }
      }
    }
  ]
}